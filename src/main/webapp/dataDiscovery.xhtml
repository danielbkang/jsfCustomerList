<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<f:loadBundle basename="com.jsonarjsf.properties.messages" var="msg" />

<h:panelGroup rendered="#{not empty loginBean.user}">
	<h:head>
		<title>#{msg.title}</title>
	</h:head>
	<h:body bgcolor="white">
		<h:form id="myForm">
			<h3>
				<p:outputLabel value="#{msg.dataDiscovery_header}" />
			</h3>
			<p:separator />
			<p:commandButton id="logoutButton" ajax="false"
				style="float: right; margin-right: 10px; margin-top: 7px;"
				value="#{msg.logout_button_text}" icon="fa fa-lock"
				action="#{loginBean.logout}" />
			<h4>
				<p:outputLabel value="#{msg.greeting_text}" />
				<p:outputLabel value="#{loginBean.user}" />
				<p:outputLabel value="#{msg.sign}" />
			</h4>

			<p:separator />

			<p:panelGrid columns="2" columnClasses="ui-grid-col-4,ui-grid-col-8"
				layout="grid" styleClass="ui-panelgrid-blank">
				<p:column>
					<p:panel>
						<p:outputLabel value="Filter: " />
						<p:inputText value="#{dataBean.filterValue}"
							style="width: 80%; 
    right: 0px;">
							<p:ajax event="keyup" update="grid"
								listener="#{dataBean.filterList()}" />
						</p:inputText>
					</p:panel>
					<p:panel id="customerListContainer" header="Customer List"
						style="margin-top:10px">

						<p:scrollPanel header="Customer List" mode="native"
							style="margin-top:0px; height: 70vh; width:100%; border: none; border-color: transparent;">

							<p:dataGrid var="customer" value="#{dataBean.filteredCustomers}"
								columns="1" layout="grid" id="grid"
								style="width: 100%; display=block;">
								<h:commandLink ajax="true" style="text-decoration: none;">
									<p:ajax event="click" update=":myForm:orderDetails"
										listener="#{dataBean.showOrderDetails(customer)}" />
									<p:panel header="Name: #{customer.customerName}"
										style="text-align:center;">
										<h:panelGrid columns="1" style="width:100%">
											<h:outputText value="Phone: #{customer.phone}" />
											<h:outputText value="#{customer.city}, #{customer.country}" />
											<p:commandLink update=":myForm:customerDetail" oncomplete="PF('customerDialog').show()" title="View Detail">
												<h:outputText styleClass="ui-icon ui-icon-search" style="margin:0 auto;" />
												<f:setPropertyActionListener value="#{customer}" target="#{dataBean.selectedCustomer}" />
											</p:commandLink>
										</h:panelGrid>
									</p:panel>
								</h:commandLink>
							</p:dataGrid>
						</p:scrollPanel>
					</p:panel>
				</p:column>
				<p:panel id="orderDetails" header="Order Details: #{dataBean.selectedCustomer.customerName}" rendered="true"
					style="margin-top:0px">
					<p:dataTable var="orderSummary" value="#{dataBean.orderSummarys}">
						<p:column headerText="ProductName">
							<h:outputText value="#{orderSummary.product.productName}" />
						</p:column>

						<p:column headerText="PriceEach">
							<h:outputText value="#{orderSummary.orderDetail.priceEach}" style="text-align:center;" />
						</p:column>

						<p:column headerText="QuantityOrdered">
							<h:outputText value="#{orderSummary.orderDetail.quantityOrdered}" />
						</p:column>
					</p:dataTable>
				</p:panel>
			</p:panelGrid>
			
			<p:dialog header="Customer Information" widgetVar="customerDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
		        <p:outputPanel id="customerDetail" style="text-align:center;">
		            <p:panelGrid  columns="2" rendered="#{not empty dataBean.selectedCustomer}" columnClasses="label,value">
		                <h:outputText value="Name:" />
		                <h:outputText value="#{dataBean.selectedCustomer.customerName}" />
		 
		                <h:outputText value="Phone: " />
		                <h:outputText value="#{dataBean.selectedCustomer.phone}" />
		 
		                <h:outputText value="Address:" />
		                <h:outputText value="#{dataBean.selectedCustomer.addressLine1}\n #{dataBean.selectedCustomer.addressLine2}"/>
		            </p:panelGrid>
		        </p:outputPanel>
		    </p:dialog>
		</h:form>
	</h:body>
</h:panelGroup>
</html>

